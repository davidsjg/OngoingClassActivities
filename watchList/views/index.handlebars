<h1>Movies to Watch</h1>


<ul>
    {{#each movies}}
    <li>
        <p>
            {{id}}. {{movie}}
            <button data-movieID="{{id}}" class="delMovie">Delete</button>
        </p>
    </li>
    {{/each}}
</ul>

<h2>Add a Movie to Watch</h2>
<form id="addMovie" class="button-size">
    <textarea type='text' name='movie' id="newMovie"></textarea>
    <button type='submit'>Save Movie</button>
</form>

<h2>Update a movie!</h2>
<form id="updateMovie" class='button-size'>
  <input type="text" name="id" placeholder="id">
  <textarea type='text' name='movie' placeholder="new movie title to update old title"></textarea>
  <button type="submit">Update Movie!</button>
</form>


<script type='text/javascript'>

 // CREATE
  const createMovieBtn = document.getElementById('addMovie')
  // Set up the event listener for the create button
  createMovieBtn.addEventListener('submit', (e) => {
    e.preventDefault();
    
    // Grabs the value of the textarea that goes by the name, "movie"
    const newMovie = {
      movie: document.getElementsByName('movie')[0].value.trim()
    }
    console.log(newMovie);

    // Send POST request to create a new movie
    fetch("/api/movies", {
      method: "POST",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },

      //make sure to serialize the JSON body
      body: JSON.stringify(newMovie)
    })
      .then((response) => {
        // Empty the form
        document.getElementsByName('movie')[0].value = ''

        // Reload the page so the user can see the new movie
        console.log("Created a new movie!")
        location.reload()
      });
})


  // DELETE
  // Get the button
  const deleteMovieBtns = document.querySelectorAll('.delMovie')


  deleteMovieBtns.forEach(button => {
    button.addEventListener('click', (e) => {
      const id = e.target.getAttribute('data-movieID')
      console.log('delete movie id', id)

      fetch(`/api/movies/${id}`, {
        method: 'DELETE',
      }).then(() => {
        console.log(`Deleted ID: ${id}`)
        location.reload()
      })

    })
  })

// UPDATE

const updateMovieBtn = document.getElementById('updateMovie')

updateMovieBtn.addEventListener('submit', (e) => {
  e.preventDefault

  const id = document.getElementsByName('id')[0].value
  const updatedMovie = {
    movie: document.getElementsByName('movie')[1].value
  }
  console.log('updatedMovie', updatedMovie)

  fetch(`/api/movies/${id}`, {
    method: 'PUT',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },

    body: JSON.stringify(updatedMovie)
  })
    .then((response) => {
      if (response.ok) {
        console.log(`Updated the movie with the id: ${id}`)
        location.reload()
      } else {
        alert('something went wrong!')
      }
    })
})



</script>
